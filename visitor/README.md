# Посетитель (Visitor)

Посетитель — это поведенческий паттерн проектирования, который позволяет добавлять в программу новые операции, не изменяя классы объектов, над которыми эти операции могут выполняться.

## Применимость

Паттерн Посетитель предлагает разместить новое поведение в отдельной структуре, вместо того чтобы множить его сразу в нескольких. Объекты, с которыми должно было быть связано поведение, не будут выполнять его самостоятельно. Вместо этого они будут передаваться в методы посетителя.

Код поведения должен отличаться для разных объектов, поэтому методов у посетителя должно быть несколько - для каждого из объектов. Названия и принцип действия этих методов будут схожи, но основное отличие будет в типе принимаемого в параметрах объекта.
Так как все методы имеют отличающуюся сигнатуру, использовать полиморфизм при переборе узлов не получится, поэтому необходимо проверять тип узлов для того, чтобы выбрать соответствующий метод посетителя. Объект, который передаётся в параметрах посетителю, ищет нужный метод и вызывает его.

При добалении нового поведения изменять объекты узлов всё-таки придётся, но это изменение позволит применять к ним и другие поведения, ведь они будут привязаны не к конкретному типу посетителей, а к их общему интерфейсу. Поэтому если придётся добавить в программу новое поведение, можно создать новый тип посетителей и передавать его в методы узлов.

## Плюсы

- Упрощает добавление операций, работающих со сложными структурами объектов.
- Объединяет родственные операции в одной структуре.
- Посетитель может накапливать состояние при обходе структуры элементов.

## Минусы

- Паттерн не оправдан, если иерархия элементов часто меняется.
- Может привести к нарушению инкапсуляции элементов.

## Применимость

- Когда вам нужно выполнить какую-то операцию над всеми элементами сложной структуры объектов, например, деревом.
Посетитель позволяет применять одну и ту же операцию к объектам различных типов.

- Когда над объектами сложной структуры объектов надо выполнять некоторые не связанные между собой операции, но не «засорять» структуры такими операциями.
Посетитель позволяет извлечь родственные операции из классов, составляющих структуру объектов, поместив их в один класс-посетитель. Если структура объектов является общей для нескольких приложений, то паттерн позволит в каждое приложение включить только нужные операции.

- Когда новое поведение имеет смысл только для некоторых объектов из существующей иерархии.
Посетитель позволяет определить поведение только для этих объектов, оставив его пустым для всех остальных.


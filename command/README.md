# Команда (Command)

Команда — это поведенческий паттерн проектирования, который превращает запросы в объекты, позволяя передавать их как аргументы при вызове методов, ставить запросы в очередь, логировать их, а также поддерживать отмену операций.

## Применимость

Хорошие программы обычно структурированы в виде слоёв, например, слои пользовательского интерфейса и бизнес-логики. Первый чаще всего рисует красивую картинку для пользователя, но когда нужно сделать что-то важное, интерфейс отправляет запрос слою бизнес-логики.

В реальности это выглядит так: один из объектов интерфейса напрямую вызывает метод одного из объектов бизнес-логики, передавая в него какие-то параметры.

Паттерн Команда предлагает не отправлять такие вызовы напрямую. Вместо этого каждый вызов, отличающийся от других, следует завернуть в собственный тип с единственным методом, который и будет осуществлять вызов. Такие объекты называют командами.

К объекту интерфейса можно будет привязать объект команды, который знает, кому и в каком виде следует отправлять запросы. Когда объект интерфейса будет готов передать запрос, он вызовет метод команды, а та — позаботится обо всём остальном.

Команды можно объединить под общим интерфейсом c единственным методом запуска. После этого одни и те же отправители смогут работать с различными командами, не привязываясь к их типам. Команды можно будет взаимозаменять на лету, изменяя итоговое поведение отправителей.

Параметры, с которыми должен быть вызван метод объекта получателя, можно загодя сохранить в полях объекта-команды. Благодаря этому, объекты, отправляющие запросы, могут не беспокоиться о том, чтобы собрать необходимые для получателя данные. Более того, они теперь вообще не знают, кто будет получателем запроса. Вся эта информация скрыта внутри команды.

Таким образом, команды станут гибкой прослойкой между пользовательским интерфейсом и бизнес-логикой

## Плюсы

- Убирает прямую зависимость между объектами, вызывающими операции, и объектами, которые их непосредственно выполняют.
- Позволяет реализовать простую отмену и повтор операций.
- Позволяет реализовать отложенный запуск операций.
- Позволяет собирать сложные команды из простых.
- Реализует принцип open-closed.

## Минусы

- Усложняет код программы из-за введения множества дополнительных типов.

## Примеры использования

- Когда нужно параметризовать объекты выполняемым действием.

    Команда превращает операции в объекты. А объекты можно передавать, хранить и взаимозаменять внутри других объектов.
    Например, при разработке библиотеки графического меню необходимо, чтобы пользователи могли использовать меню в разных приложениях, не меняя каждый раз код уже существующих объектов. Применив паттерн, пользователям не придётся изменять объекты меню, вместо этого они будут конфигурировать объекты меню различными командами.

- Когда нужно ставить операции в очередь, выполнять их по расписанию или передавать по сети.

    Как и любые другие объекты, команды можно сериализовать, то есть превратить в строку, чтобы потом сохранить в файл или базу данных. Затем в любой удобный момент её можно достать обратно, снова превратить в объект команды и выполнить. Таким же образом команды можно передавать по сети, логировать или выполнять на удалённом сервере.

- Когда нужна операция отмены.

    Паттерн Команда является самым популярным способом хранения истории для возможности отмены операций.
    История команд выглядит как стек, в который попадают все выполненные объекты команд. Каждая команда перед выполнением операции сохраняет текущее состояние объекта, с которым она будет работать. После выполнения операции копия команды попадает в стек истории, все ещё неся в себе сохранённое состояние объекта. Если потребуется отмена, программа возьмёт последнюю команду из истории и возобновит сохранённое в ней состояние.
    Копии состояния могут занимать довольно много оперативной памяти. Поэтому иногда можно прибегнуть к альтернативной реализации, когда вместо восстановления старого состояния команда выполняет обратное действие. Недостаток этого способа в сложности (а иногда и невозможности) реализации обратного действия.
